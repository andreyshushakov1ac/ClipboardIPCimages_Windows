Задачa.

Создать приложение, состоящее из двух процессов:
− первый процесс записывает графический файл (растр или tiff) в буфер обмена;
− второй процесс считывает информацию из буфера обмена и отобразить ее в окне процесса.

Теория.

Общая процедура записи данных в буфер обмена состоит из следующих шагов: 

a) Прежде чем поместить в буфер обмена какую-либо информацию, ваша программа (далее просто окно) должна его открыть, используя функцию OpenClipboard: if (OpenClipboard(hDlg)) //открываем буфер обмена 

b) После того, как программа открыла буфер обмена, она должна его очистить от предыдущего содержания, для чего следует вызвать функцию EmptyClipboard. if (EmptyClipboard()) //очищение буфера обмена 

c) Выделяем блок глобальной памяти, достаточный для того, чтобы хранить в нем данные, которые необходимо поместить в буфер обмена. 
HGLOBAL hGl; hGl = GlobalAlloc(GMEM_DDESHARE, strlen(buffer2)); //заказываем блок памяти 

Функция GlobalAlloc() выделяет память и возвращает дескриптор выделенного блока. Для получения указателя на область памяти, выделенную при помощи GlobalAlloc(), следует использовать функцию 
GlobalLock(): LPVOID lpstr = (char *) GlobalLock(hGl); //блокируем его Функция GlobalLock() фиксирует в памяти объект (блок), дескриптор которого передается в параметре hGl. Зафиксированный объект не перемещается в памяти и не выгружается. Функция GlobalLock() возвращает адрес начала блока в случае успешного завершения или NULL при возникновении ошибки. После получения указателя на глобальный блок памяти необходимо скопировать в этот блок данные, которые Вы хотите поместить в буфер обмена. 
memcpy(lpstr, buffer2, strlen(buffer2)); //записываем данные  

Когда копирование завершится, блок памяти можно разблокировать, вызвав функцию 
GlobalUnlock(): GlobalUnlock(hGl); //разблокировать блок 
Теперь мы имеем полное право помещать в него свои данные в различных форматах, используя функцию 
SetClipboardData. SetClipboardData(CF_TEXT, hGl); //помещаем данные в буфер обмена 

Для чтения данных из буфера обмена используется следующая последовательность шагов: 

a) Необходимо открыть буфер обмена; 
if (OpenClipboard(hDlg)) 
Чтобы получить доступ к данным, хранящимся в буфере обмена, последний должен быть открыт. 

b) Чтобы извлечь информацию из буфера обмена, окно должно вызвать функцию 
GetClipboardData. HANDLE hData = GetClipboardData(CF_TEXT); //извлекаем информацию из буфера 
Данная функция в качестве параметра принимает формат буфера обмена, для того чтобы извлечь данные в этом формате. Если в буфер обмена данные поместила другая программа, вы можете проверить доступные форматы данных перед их непосредственным извлечением, используя функцию IsClipboardFormatAvailable. if (IsClipboardFormatAvailable(CF_TEXT)) //проверка на доступные файлы 

c) Копируем данные из буфера обмена

d) Закрываем буфер обмена CloseClipboard();
Пользовательский формат данных Возможно ситуация, когда приложению необходимо поместить данные в буфер обмена, а стандартные форматы для этого не подходят. Выходом из такой ситуации является возможность регистрации собственного формата данных. Для того чтобы зарегистрировать новый формат буфера обмена, используется функция RegisterClipboardFormat. 
В качестве параметра этой функции следует передать указатель на текстовую строку, закрытую двоичным нулем и содержащую имя регистрируемого нестандартного формата данных для буфера обмена. Функция возвращает нулевое значение при ошибке или идентификатор зарегистрированного формата данных, который можно использовать аналогично идентификаторам стандартных форматов в качестве параметра функции SetClipboardData. Два различных приложения или две копии одного приложения могут зарегистрировать формат с одним и тем же именем, при этом функция RegisterClipboardFormat вернет один и тот же идентификатор формата. Поэтому два приложения всегда смогут "договориться", если они знают имя нестандартного формата данных. 

Концепция "контекст устройства" (device context) в Windows связана с графическими операциями, такими как рисование на экране, вывод изображений на принтер и другие действия, связанные с отображением графики. Контекст устройства представляет собой структуру данных, которая содержит информацию о графических свойствах устройства вывода (например, экрана или принтера) и позволяет программе взаимодействовать с этим устройством для выполнения графических операций. Например, контекст устройства может содержать информацию о текущем шрифте, цвете рисования, разрешении экрана и других параметрах.
    Глобальная память (global memory) в Windows представляет собой область памяти, которая доступна для использования различными процессами в системе. Глобальная память позволяет обмениваться данными между процессами, а также хранить данные в общей доступной области памяти. Для работы с глобальной памятью используются функции операционной системы Windows, которые позволяют выделить блок памяти, записать данные в этот блок и освободить его после использования.
    В контексте программы по заданию:
- "контекст устройства" используется для загрузки изображения из файла и представления его в виде растрового изображения в памяти.
- "глобальная память" используется для сохранения данных изображения в формате, который можно скопировать в буфер обмена Windows и передать другим приложениям. В данном случае, данные изображения копируются в глобальный блок памяти, который затем помещается в буфер обмена для возможности обмена данными между различными приложениями.
